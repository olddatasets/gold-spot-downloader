<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gold Price Data Sources Timeline</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            height: 400px;
        }
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .legend-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .legend-item h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
        }
        .legend-item p {
            margin: 5px 0;
            font-size: 14px;
            color: #666;
        }
        .legend-item .granularity {
            font-weight: bold;
            color: #333;
        }
        .strategy-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        footer {
            text-align: center;
            margin-top: 40px;
            color: #666;
            font-size: 14px;
        }
        a {
            color: #0066cc;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>Gold Price Data Sources & Timeline</h1>
    <p style="text-align: center; color: #666;">Comprehensive gold price data spanning nearly 800 years (1257-present)</p>

    <div class="chart-container">
        <canvas id="timelineChart"></canvas>
    </div>

    <div class="legend" id="legendContainer">
        <!-- Will be populated dynamically -->
    </div>

    <div class="strategy-box">
        <h2>Merge Strategy</h2>
        <p><strong>Priority Order:</strong> When dates overlap, we use the following priority (highest first):</p>
        <ol>
            <li><strong>Yahoo Finance</strong> - Daily data, 2025-present (highest priority, most granular current data)</li>
            <li><strong>World Bank</strong> - Monthly data, 1960-2024</li>
            <li><strong>MeasuringWorth London</strong> - Annual data, 1718-1959</li>
            <li><strong>MeasuringWorth British</strong> - Annual data, 1257-1717 (fills oldest historical gaps)</li>
        </ol>
        <p>This provides comprehensive historical gold price data spanning nearly 800 years (1257-2025) with increasing granularity over time.</p>
    </div>

    <footer>
        <p><a href="index.html">← Back to data download</a> | <a href="https://github.com/posix4e/freeprice.gold">GitHub Repository</a></p>
        <p>Data compiled for non-profit educational purposes</p>
        <p><small>MeasuringWorth Citation: Lawrence H. Officer and Samuel H. Williamson, 'The Price of Gold, 1257-2024,' MeasuringWorth, 2025</small></p>
    </footer>

    <script>
        // Source metadata
        const sourceMetadata = {
            'measuringworth_british': {
                name: 'MeasuringWorth - British Official Price',
                granularity: 'Annual',
                color: '#8B4513',
                url: 'https://www.measuringworth.com/datasets/gold/',
                description: 'Oldest gold price data available'
            },
            'measuringworth_london': {
                name: 'MeasuringWorth - London Market Price',
                granularity: 'Annual',
                color: '#DAA520',
                url: 'https://www.measuringworth.com/datasets/gold/',
                description: 'London market price from 1718'
            },
            'worldbank': {
                name: 'World Bank Commodity Prices',
                granularity: 'Monthly',
                color: '#FFD700',
                url: 'https://www.worldbank.org/en/research/commodity-markets',
                description: 'Pink Sheet gold prices (1960-2024)'
            },
            'yahoo_finance': {
                name: 'Yahoo Finance - Gold Futures',
                granularity: 'Daily',
                color: '#FFA500',
                url: 'https://finance.yahoo.com/quote/GC=F',
                description: 'Current gold futures prices (2025-present)'
            }
        };

        // Load and display data
        Promise.all([
            fetch('data/source_ranges_full.json').then(r => r.json()),
            fetch('data/source_stats.json').then(r => r.json())
        ])
            .then(([fullRanges, usedStats]) => {
                console.log('Loaded full ranges:', fullRanges);
                console.log('Loaded used stats:', usedStats);
                createTimeline(fullRanges);
                createLegend(fullRanges, usedStats);
            })
            .catch(error => {
                console.error('Error loading source data:', error);
                const isFileProtocol = window.location.protocol === 'file:';
                const errorMsg = isFileProtocol
                    ? '<p style="color: #d9534f; text-align: center;"><strong>CORS Error:</strong> This page must be served via HTTP/HTTPS to load data.<br>Run <code>python -m http.server</code> in the project directory and visit <code>http://localhost:8000/sources.html</code></p>'
                    : '<p style="color: #999; text-align: center;">Source statistics will appear here after running the merge script.</p>';
                document.getElementById('legendContainer').innerHTML = errorMsg;
            });

        function createTimeline(stats) {
            const ctx = document.getElementById('timelineChart').getContext('2d');

            const datasets = Object.entries(stats).map(([source, data]) => {
                const metadata = sourceMetadata[source] || {};
                const startYear = parseInt(data.start.split('-')[0]);
                const endYear = parseInt(data.end.split('-')[0]);

                console.log(`Creating dataset for ${source}: ${startYear} to ${endYear}`);

                return {
                    label: metadata.name || source,
                    data: [{
                        x: [new Date(startYear, 0, 1), new Date(endYear, 11, 31)],
                        y: metadata.name || source
                    }],
                    backgroundColor: metadata.color || '#999',
                    borderColor: '#333',
                    borderWidth: 2,
                    barThickness: 50
                };
            });

            console.log('Creating chart with datasets:', datasets);

            new Chart(ctx, {
                type: 'bar',
                data: { datasets },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Data Source Coverage Timeline (1200 - Present)',
                            font: { size: 18 }
                        },
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const start = new Date(context.raw.x[0]);
                                    const end = new Date(context.raw.x[1]);
                                    const years = end.getFullYear() - start.getFullYear() + 1;
                                    return [
                                        `${context.dataset.label}`,
                                        `Range: ${start.getFullYear()} - ${end.getFullYear()}`,
                                        `Years covered: ${years}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'year',
                                displayFormats: { year: 'yyyy' }
                            },
                            title: {
                                display: true,
                                text: 'Year',
                                font: { size: 14 }
                            },
                            min: new Date(1200, 0, 1),
                            max: new Date(new Date().getFullYear() + 1, 0, 1)
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Data Source',
                                font: { size: 14 }
                            }
                        }
                    }
                }
            });
        }

        function createLegend(fullRanges, usedStats) {
            const legendHtml = Object.entries(fullRanges).map(([source, fullData]) => {
                const metadata = sourceMetadata[source] || {};
                const usedData = usedStats[source] || fullData;

                const fullStartYear = parseInt(fullData.start.split('-')[0]);
                const fullEndYear = parseInt(fullData.end.split('-')[0]);
                const fullYears = fullEndYear - fullStartYear + 1;

                const usedStartYear = parseInt(usedData.start.split('-')[0]);
                const usedEndYear = parseInt(usedData.end.split('-')[0]);
                const usedYears = usedEndYear - usedStartYear + 1;

                return `
                    <div class="legend-item" style="border-left-color: ${metadata.color || '#999'};">
                        <h3>${metadata.name || source}</h3>
                        <p class="granularity">${metadata.granularity || 'Unknown'} granularity</p>
                        <p><strong>Full coverage:</strong> ${fullData.start} to ${fullData.end} (${fullData.count.toLocaleString()} records, ${fullYears.toLocaleString()} years)</p>
                        <p><strong>Used in dataset:</strong> ${usedData.count.toLocaleString()} records from ${usedData.start} to ${usedData.end} (${usedYears.toLocaleString()} years)</p>
                        <p>${metadata.description || ''}</p>
                        ${metadata.url ? `<p><a href="${metadata.url}" target="_blank">Visit source →</a></p>` : ''}
                    </div>
                `;
            }).join('');

            document.getElementById('legendContainer').innerHTML = legendHtml;
        }
    </script>
</body>
</html>
